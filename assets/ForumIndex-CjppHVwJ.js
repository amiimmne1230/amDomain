import{_ as Ce}from"./SiteScroll.vue_vue_type_script_setup_true_lang-YRJpY-Ce.js";import{a as Le,b as De,e as X,f as q,D as G,q as le,w as he,i as Ne,l as Be,o as Re,c as Ue}from"./NavigationTempl.vue_vue_type_script_setup_true_lang-DHfa6EIZ.js";import{_ as Fe}from"./DomainTime.vue_vue_type_script_setup_true_lang-B3lQGwHd.js";import{d as me,y as He,b as te,r as T,j as O,c as C,e as r,f as o,t as K,g,V as re,h as ce,K as ze,i as k,W as ke,X as Pe,o as Se,O as Ve,B as ge,Y as je,u as We,Z as Ye,J as Xe,D as Q,_ as qe,z as ae,H as Ge,A as J,F as H,C as Z,E as R,G as P,I as ee,U as Ke}from"./index-BAeDBPMX.js";import{s as Qe}from"./useArticle-CDEmWH90.js";import"./Constant-BYt20L2w.js";var Je=typeof global=="object"&&global&&global.Object===Object&&global,Ze=typeof self=="object"&&self&&self.Object===Object&&self,Ee=Je||Ze||Function("return this")(),ne=Ee.Symbol,Ie=Object.prototype,et=Ie.hasOwnProperty,tt=Ie.toString,V=ne?ne.toStringTag:void 0;function rt(e){var l=et.call(e,V),s=e[V];try{e[V]=void 0;var c=!0}catch(b){}var _=tt.call(e);return c&&(l?e[V]=s:delete e[V]),_}var nt=Object.prototype,st=nt.toString;function ot(e){return st.call(e)}var lt="[object Null]",at="[object Undefined]",be=ne?ne.toStringTag:void 0;function it(e){return e==null?e===void 0?at:lt:be&&be in Object(e)?rt(e):ot(e)}function ct(e){return e!=null&&typeof e=="object"}var dt="[object Symbol]";function mt(e){return typeof e=="symbol"||ct(e)&&it(e)==dt}var ut=/\s/;function xt(e){for(var l=e.length;l--&&ut.test(e.charAt(l)););return l}var ft=/^\s+/;function pt(e){return e&&e.slice(0,xt(e)+1).replace(ft,"")}function de(e){var l=typeof e;return e!=null&&(l=="object"||l=="function")}var ye=NaN,vt=/^[-+]0x[0-9a-f]+$/i,ht=/^0b[01]+$/i,gt=/^0o[0-7]+$/i,bt=parseInt;function _e(e){if(typeof e=="number")return e;if(mt(e))return ye;if(de(e)){var l=typeof e.valueOf=="function"?e.valueOf():e;e=de(l)?l+"":l}if(typeof e!="string")return e===0?e:+e;e=pt(e);var s=ht.test(e);return s||gt.test(e)?bt(e.slice(2),s?2:8):vt.test(e)?ye:+e}var ie=function(){return Ee.Date.now()},yt="Expected a function",_t=Math.max,wt=Math.min;function we(e,l,s){var c,_,b,x,a,f,w=0,p=!1,m=!1,M=!0;if(typeof e!="function")throw new TypeError(yt);l=_e(l)||0,de(s)&&(p=!!s.leading,m="maxWait"in s,b=m?_t(_e(s.maxWait)||0,l):b,M="trailing"in s?!!s.trailing:M);function i(n){var h=c,N=_;return c=_=void 0,w=n,x=e.apply(N,h),x}function v(n){return w=n,a=setTimeout(j,l),p?i(n):x}function S(n){var h=n-f,N=n-w,F=l-h;return m?wt(F,b-N):F}function L(n){var h=n-f,N=n-w;return f===void 0||h>=l||h<0||m&&N>=b}function j(){var n=ie();if(L(n))return U(n);a=setTimeout(j,S(n))}function U(n){return a=void 0,M&&c?i(n):(c=_=void 0,x)}function W(){a!==void 0&&clearTimeout(a),w=0,c=f=_=a=void 0}function se(){return a===void 0?x:U(ie())}function z(){var n=ie(),h=L(n);if(c=arguments,_=this,f=n,h){if(a===void 0)return v(f);if(m)return clearTimeout(a),a=setTimeout(j,l),i(f)}return a===void 0&&(a=setTimeout(j,l)),x}return z.cancel=W,z.flush=se,z}const Tt={class:"border-b w-full flex items-end font-bold cursor-pointer border-stone-400 text-stone-400 hover:mix-blend-difference"},kt={class:"xl:pt-2 md:pt-1 max-md:pt-0.5"},St={class:"break-all line-clamp-2 text-stone-400/50 xl:w-[calc(1.25rem*20)] xl:text-[1.25rem] md:w-[calc(1rem*20)] md:text-[1rem] max-md:max-w-[calc(0.75rem*20)] max-md:text-[0.75rem]"},jt={class:"break-all line-clamp-2 xl:w-[calc(1.5rem*20)] xl:text-[1.25rem] md:w-[calc(1rem*20)] md:text-[1rem] max-md:max-w-[calc(0.75rem*20)] max-md:text-[0.75rem]"},Et={class:"flex flex-col ml-auto xl:text-[1.2rem] md:text-[1rem] max-md:text-[0.8rem]"},It={class:"flex justify-end gap-5"},Ot={class:"flex gap-1 items-center"},Mt={class:"flex gap-1 items-center"},$t=me({__name:"ReviewArticleTempl",props:He({article:{}},{forumTemplModels:{},forumTemplModelsModifiers:{},reviewImageObject:{},reviewImageObjectModifiers:{}}),emits:["update:forumTemplModels","update:reviewImageObject"],setup(e){const l=ze(),s=e,c=te(e,"forumTemplModels"),_=te(e,"reviewImageObject"),b=i=>{l.push({path:i})},x=T(""),a=O(()=>{var i;return((i=c.value)==null?void 0:i.alias)||s.article.alias}),f=O(()=>{var i,v;return x.value=((i=c.value)==null?void 0:i.path)||s.article.path,((v=c.value)==null?void 0:v.path)||s.article.path}),w=O(()=>{var v;return((v=c.value)==null?void 0:v.time)||s.article.time}),p=O(()=>{var S;const i=((S=c.value)==null?void 0:S.analyze.rating)||s.article.analyze.rating;return{nice:i.nice,bad:i.bad}});O(()=>{var v;return((v=c.value)==null?void 0:v.analyze.views)||s.article.analyze.views});const m=O(()=>{var S,L;const i=((S=c.value)==null?void 0:S.history.length)||s.article.history.length;return((L=c.value)==null?void 0:L.history[i-1].articleTitle)||s.article.history[i-1].articleTitle}),M=()=>{_.value.isEnterElement=!1};return(i,v)=>{const S=ce("Icon"),L=Fe;return k(),C("div",{onMouseleave:M},[r("div",{onClick:v[0]||(v[0]=j=>b(o(f)))},[r("div",Tt,[r("span",kt,[r("p",St,K(o(a)),1),r("p",jt,K(o(m)),1)]),r("span",Et,[r("div",It,[r("p",Ot,[g(S,{icon:"ic:round-thumb-up-alt",class:"xl:w-[1.2rem] xl:h-[1.2rem] md:w-[1rem] md:h-[1rem] max-md:w-[0.8rem] max-md:h-[0.8rem]"}),re(" "+K(o(p).nice),1)]),r("p",Mt,[g(S,{icon:"ic:round-thumb-down-alt",class:"xl:w-[1.2rem] xl:h-[1.2rem] md:w-[1rem] md:h-[1rem] max-md:w-[0.8rem] max-md:h-[0.8rem]"}),re(" "+K(o(p).bad),1)])]),r("p",null,[g(L,{paramTime:o(w),fromNow:""},null,8,["paramTime"])])])])])],32)}}}),At=["src"],Te=.08,Ct=me({__name:"followWhatYouSee",props:{imageString:{},imageStringModifiers:{},isEnterElement:{type:Boolean},isEnterElementModifiers:{}},emits:["update:imageString","update:isEnterElement"],setup(e){ke(je);const l=T(),s=te(e,"imageString"),c=te(e,"isEnterElement"),{x:_,y:b}=Pe();let x=0,a=0,f=0,w=0,p;return Se(()=>{const m=()=>{x=_.value,a=b.value,f+=(x-f)*Te,w+=(a-w)*Te,l.value.style.top="".concat(w,"px"),l.value.style.left="".concat(f,"px"),p=requestAnimationFrame(m)};m()}),Ve(()=>{cancelAnimationFrame(p)}),(m,M)=>(k(),C("div",{ref_key:"movingDiv",ref:l,class:"absolute -z-10 pointer-events-none select-none"},[r("div",{class:"absolute -z-20 object-cover -translate-1/2 md:w-[202px] max-md:w-[122px] transition-[height] duration-[0.3s] bg-stone-700 mix-blend-difference",style:ge({height:c.value?0:"0px"})},null,4),r("img",{src:s.value,class:"object-cover -translate-1/2 md:w-[200px] max-md:w-[120px] transition-[height] duration-[0.3s]",style:ge({height:c.value?0:"0px"})},null,12,At)],512))}}),Lt={ref:"root"},Dt={class:"[&>div]:xl:first:mt-[100px] [&>div]:md:first:mt-[80px] [&>div]:max-md:first:mt-[60px]"},Nt={class:"xl:flex-2/3 md:flex-3/4"},Bt={class:"border-y border-stone-400 py-5 grid grid-cols-3"},Rt={class:"p-2"},Ut={class:"transImage w-full h-full border relative text-stone-400 border-stone-400 hover:text-stone-700 hover:border-stone-700 flex items-end overflow-hidden xl:h-[120px] md:h-[100px] max-md:h-[70px] after:backdrop-blur-[2px] after:absolute after:content-[''] after:w-full after:h-full after:-z-20"},Ft=["src"],Ht=["src"],zt={class:"px-2 font-bold max-md:text-[0.8rem]"},Pt={class:"p-2"},Vt={class:"flex"},Wt=["disabled"],Yt=["disabled"],Xt={class:"flex-col flex xl:flex-1/3 md:flex-2/4"},qt={class:"md:sticky md:top-[100px] flex flex-col"},Gt={class:"font-bold xl:text-[6rem] md:text-[3rem] max-md:text-[2rem]"},Kt={class:"px-2"},Qt={class:"flex gap-3 select-none flex-wrap"},Jt={class:"flex"},Zt={class:"flex"},er={class:"flex"},tr={class:"flex"},rr={class:"w-[82%] xl:my-10 md:my-5 max-md:my-5 max-md:sticky max-md:top-[100px]"},nr={ref:"searchForm",class:"relative group flex-7/12 flex items-center"},sr={class:"absolute group-focus-within:text-stone-700 text-stone-400",for:"s"},or={class:"xl:flex-2/3 md:flex-2/4"},lr=5,xr=me({__name:"ForumIndex",setup(e){var fe;const l=We(),s=Ye({isEnterElement:!1,imageSource:""}),c=ke(je),_=Xe(),b=O(()=>_.path.split("/")[1]||"index"),x=T([]),a=T([]),f=T([]),w=async()=>{const d=X(G,"topics");(await q(d)).forEach(u=>{x.value.push({...u.data()})})},p=T(!1),m=T(!0),M=T(null),i=async(d=!1)=>{var t;if(!(p.value||!m.value)){p.value=!0;try{let u;const $=((t=x.value.find(B=>B.name===b.value))==null?void 0:t.articleIDs)||[],E=X(G,"articles"),A=$.slice(0,ue.value);console.log(A),d?(a.value=[],M.value=null,m.value=!0,u=le(E,he("xid","in",A))):u=le(E,he("xid","in",A),Ne(M.value));const D=await q(u);if(console.log(D.docs),D.empty){m.value=!1,p.value=!1;return}const oe=D.docs[D.docs.length-1];M.value=oe,D.forEach(B=>{a.value.push({...B.data()})})}catch(u){console.error(u)}finally{p.value=!1}}},v=async()=>{if(f.value.length>0)return;const d=X(G,"articles"),t=le(d,Re("time","desc"),Be(2));(await q(t)).forEach($=>{f.value.push({...$.data()})})},S=async()=>{if(!h.value.trim()){p.value=!1,m.value=!0,await i(!0);return}try{p.value=!0,a.value=[];const d=X(G,"articles"),t=await q(d),u=h.value.toLowerCase();t.forEach($=>{const E={...$.data()},A=E.history.length-1;(E.history[A].articleTitle.toLowerCase().includes(u)||E.history[A].articleHtmlRef.toLowerCase().includes(u))&&a.value.push(E)}),m.value=!1}catch(d){console.error("Error searching articles:",d)}finally{p.value=!1}},L=we(async()=>{!p.value&&m.value&&await i(!1)},300);Se(async()=>{await w(),i(!0),v()}),Q(b,()=>{n.value="order",p.value=!1,m.value=!0,i(!0)});const j=T(1),U=(fe=c==null?void 0:c.value.fetchTopics)!=null?fe:0,W=O(()=>{const d=j.value*U,t=(j.value-1)*U;return{currentMax:d,currentMin:t}}),se=()=>{j.value-=1},z=()=>{j.value+=1},n=T("order");Q(n,()=>{Qe(n.value,a.value)});const h=T("");Q(h,we(()=>{S()},500));const N=O(()=>{var u,$;const d=(u=x.value.find(E=>E.name===b.value))!=null?u:null,t=($=d==null?void 0:d.nickname)!=null?$:"開始聊";return l.topicTitle=t==="同領地"?"開始聊":t,l.articleTitle="",d}),F=T(!1),ue=T(lr),{y:Oe}=qe(),Me=O(()=>{const d=document.documentElement.scrollHeight,t=window.innerHeight;return{scrollableHeight:d-t,currentScrollY:Oe.value,windowHeight:t}}),xe=O(()=>{const{scrollableHeight:d,currentScrollY:t,windowHeight:u}=Me.value;return!F.value&&t>0&&(F.value=!0),!!(F.value&&d-t<u*.1)});return Q(xe,()=>{xe.value&&(ue.value+=5,L())}),(d,t)=>{const u=Ct,$=Le,E=$t,A=De,D=Ue,oe=ce("router-link"),B=ce("Icon"),$e=Ce;return k(),C("div",Lt,[g(u,{isEnterElement:o(s).isEnterElement,"onUpdate:isEnterElement":t[0]||(t[0]=y=>o(s).isEnterElement=y),imageString:o(s).imageSource,"onUpdate:imageString":t[1]||(t[1]=y=>o(s).imageSource=y)},null,8,["isEnterElement","imageString"]),g($),r("div",Dt,[o(b)==="index"?(k(),ae(A,{key:0,class:"xl:flex xl:item-start xl:py-20 md:flex md:item-start md:py-10 max-md:flex-col max-md:py-6"},{default:J(()=>[t[9]||(t[9]=r("h2",{class:"xl:text-[2.5rem] xl:flex-1/3 md:text-[2rem] md:flex-1/4 max-md:text-[1.5rem]"}," 熱門文章 ",-1)),r("div",Nt,[o(f).length>0?(k(!0),C(H,{key:0},Z(o(f),y=>(k(),ae(E,{reviewImageObject:o(s),"onUpdate:reviewImageObject":t[2]||(t[2]=Y=>R(s)?s.value=Y:null),article:y},null,8,["reviewImageObject","article"]))),256)):(k(),C(H,{key:1},[re(" still loading... ")],64))])]),_:1})):Ge("",!0),g(A,{class:"!p-0 !py-10 select-none"},{default:J(()=>[r("div",Bt,[o(x).length>0?(k(!0),C(H,{key:0},Z(o(x).slice(o(W).currentMin,o(W).currentMax),y=>(k(),C("div",Rt,[g(oe,{to:y.path},{default:J(()=>[r("div",Ut,[r("img",{src:"./".concat(y.image),class:"scale-up filter-[var(--imageTrans)] -right-4 -bottom-2 rounded-full absolute z-10w-20 h-20"},null,8,Ft),r("img",{src:"./".concat(y.image),class:"scale-up filter-[var(--imageTrans)] -right-8 -bottom-4 rounded-full absolute opacity-20 z-10 w-40 h-40"},null,8,Ht),r("div",zt,[g(D,{text:y.nickname},null,8,["text"])])])]),_:2},1032,["to"])]))),256)):(k(),C(H,{key:1},Z(3,y=>r("div",Pt,t[10]||(t[10]=[r("div",{class:"xl:h-[120px] animate-pulse bg-stone-400 md:h-[100px] max-md:h-[70px]"},null,-1)]))),64))]),r("div",Vt,[r("button",{disabled:o(j)===1,class:"disabled:text-stone-400/50 disabled:cursor-not-allowed not-disabled:cursor-pointer enabled:hover:[&>svg]:-translate-x-10 flex-1/2 flex justify-center border-b border-r border-stone-400 py-1",onClick:se},[g(B,{class:"transition ease-in-out duration-300 transform xl:w-10 xl:h-10",icon:"stash:arrow-left-large-light"})],8,Wt),r("button",{disabled:o(j)>o(x).length/o(U),class:"disabled:text-stone-400/50 disabled:cursor-not-allowed not-disabled:cursor-pointer enabled:hover:[&>svg]:translate-x-10 flex-1/2 flex justify-center border-b border-stone-400 py-1",onClick:z},[g(B,{class:"transition ease-in-out duration-300 transform xl:w-10 xl:h-10",icon:"stash:arrow-right-large-light"})],8,Yt)])]),_:1}),g(A,{ref:"root",class:"w-full py-10 xl:flex xl:item-start md:flex md:item-start max-lg:flex-col max-md:flex-col"},{default:J(()=>{var y,Y,pe,ve;return[r("div",Xt,[r("div",qt,[r("h2",Gt,[g(D,{text:(Y=(y=o(N))==null?void 0:y.nickname)!=null?Y:"/*15a"},null,8,["text"])]),r("div",Kt,[g(D,{text:(ve=(pe=o(N))==null?void 0:pe.description)!=null?ve:"/*13ad|15a"},null,8,["text"])]),r("div",Qt,[r("div",Jt,[P(r("input",{type:"radio",id:"order",name:"msg",value:"order","onUpdate:modelValue":t[3]||(t[3]=I=>R(n)?n.value=I:null),class:"hidden peer"},null,512),[[ee,o(n)]]),t[11]||(t[11]=r("label",{for:"order",class:"border-dashed border-2 border-transparent hover:border-stone-400 flex items-center cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 按順序 ",-1))]),r("div",Zt,[P(r("input",{type:"radio",id:"newest",name:"msg",value:"newest","onUpdate:modelValue":t[4]||(t[4]=I=>R(n)?n.value=I:null),class:"hidden peer"},null,512),[[ee,o(n)]]),t[12]||(t[12]=r("label",{for:"newest",class:"border-dashed border-2 border-transparent hover:border-stone-400 cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 最新 ",-1))]),r("div",er,[P(r("input",{type:"radio",id:"mostLiked",name:"mostLiked",value:"mostLiked","onUpdate:modelValue":t[5]||(t[5]=I=>R(n)?n.value=I:null),class:"hidden peer"},null,512),[[ee,o(n)]]),t[13]||(t[13]=r("label",{for:"mostLiked",class:"border-dashed border-2 border-transparent hover:border-stone-400 cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 最多讚 ",-1))]),r("div",tr,[P(r("input",{type:"radio",id:"worst",name:"msg",value:"worst","onUpdate:modelValue":t[6]||(t[6]=I=>R(n)?n.value=I:null),class:"hidden peer"},null,512),[[ee,o(n)]]),t[14]||(t[14]=r("label",{for:"worst",class:"border-dashed border-2 border-transparent hover:border-stone-400 cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 最爛 ",-1))])]),r("div",rr,[r("form",nr,[r("label",sr,[g(B,{icon:"ic:baseline-search",class:"xl:w-6 xl:h-6 md:w-4.5 md:h-4.5 max-md:w-4 max-md:h-4"})]),P(r("input",{"onUpdate:modelValue":t[7]||(t[7]=I=>R(h)?h.value=I:null),type:"text",id:"s",placeholder:"文章搜尋...",class:"w-full xl:px-7 xl:h-10 xl:text-[1.2rem] md:px-5 md:h-8 md:text-[1rem] max-md:px-5 max-md:h-5 max-md:text-[1rem] outline-none bg-none border-b border-transparent relative border-b-stone-400 focus:border-b-stone-700"},null,512),[[Ke,o(h)]])],512)])])]),r("div",or,[o(a).length>0?(k(!0),C(H,{key:0},Z(o(a),I=>(k(),ae(E,{key:I.xid,ref_for:!0,ref:"currentArticleScroll",reviewImageObject:o(s),"onUpdate:reviewImageObject":t[8]||(t[8]=Ae=>R(s)?s.value=Ae:null),article:I},null,8,["reviewImageObject","article"]))),128)):(k(),C(H,{key:1},[re(" still loading... ")],64))])]}),_:1},512)]),g($e)],512)}}});export{xr as default};
