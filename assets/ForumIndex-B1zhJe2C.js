import{_ as Le}from"./SiteScroll.vue_vue_type_script_setup_true_lang-BbH2QfgF.js";import{a as Ae,b as Ce,e as X,f as q,D as G,q as ae,w as ge,i as De,l as Ne,o as Re,c as Be,_ as Fe}from"./NavigationTempl.vue_vue_type_script_setup_true_lang-D4-4HDxy.js";import{_ as Ue}from"./DomainTime.vue_vue_type_script_setup_true_lang-DM1tzQib.js";import{d as me,y as He,H as Pe,b as te,g as T,i as O,r as ce,c as L,o as k,e as n,j as l,t as Q,f as y,S as re,U as ke,V as Ve,h as Se,L as We,B as he,W as je,u as Ye,X as Xe,G as qe,Y as K,Z as Ge,z as le,Q as Qe,A as Z,F as U,C as J,E as P,_ as ee,D as R,R as Ke}from"./index-ColM6DKN.js";import"./Constant-BYt20L2w.js";const Ze=(e,o)=>{switch(e){case"hot":return o.sort((t,s)=>{const v=s.analyze.views+s.analyze.rating.nice+s.analyze.rating.bad,g=t.analyze.views+t.analyze.rating.nice+t.analyze.rating.bad;return v-g});case"cool":return o.sort((t,s)=>{const v=s.analyze.views+s.analyze.rating.nice+s.analyze.rating.bad;return t.analyze.views+t.analyze.rating.nice+t.analyze.rating.bad-v});case"newest":return console.log(o),o.sort((t,s)=>s.time-t.time);case"order":return o.sort((t,s)=>t.time-s.time);case"mostLiked":return o.sort((t,s)=>s.analyze.rating.nice-t.analyze.rating.nice);case"worst":return o.sort((t,s)=>t.analyze.rating.bad-s.analyze.rating.bad)}},Je={class:"border-b w-full flex items-end font-bold cursor-pointer border-stone-400 text-stone-400 hover:mix-blend-difference"},et={class:"xl:pt-2 md:pt-1 max-md:pt-0.5"},tt={class:"break-all line-clamp-2 text-stone-400/50 xl:w-[calc(1.25rem*20)] xl:text-[1.25rem] md:w-[calc(1rem*20)] md:text-[1rem] max-md:max-w-[calc(0.75rem*20)] max-md:text-[0.75rem]"},rt={class:"break-all line-clamp-2 xl:w-[calc(1.5rem*20)] xl:text-[1.25rem] md:w-[calc(1rem*20)] md:text-[1rem] max-md:max-w-[calc(0.75rem*20)] max-md:text-[0.75rem]"},nt={class:"flex flex-col ml-auto xl:text-[1.2rem] md:text-[1rem] max-md:text-[0.8rem]"},st={class:"flex justify-end gap-5"},ot={class:"flex gap-1 items-center"},at={class:"flex gap-1 items-center"},lt=me({__name:"ReviewArticleTempl",props:He({article:{}},{forumTemplModels:{},forumTemplModelsModifiers:{},reviewImageObject:{},reviewImageObjectModifiers:{}}),emits:["update:forumTemplModels","update:reviewImageObject"],setup(e){const o=Pe(),t=e,s=te(e,"forumTemplModels"),v=te(e,"reviewImageObject"),g=c=>{o.push({path:c})},x=T(""),i=O(()=>{var c;return((c=s.value)==null?void 0:c.alias)||t.article.alias}),f=O(()=>{var c,h;return x.value=((c=s.value)==null?void 0:c.path)||t.article.path,((h=s.value)==null?void 0:h.path)||t.article.path}),w=O(()=>{var h;return((h=s.value)==null?void 0:h.time)||t.article.time}),p=O(()=>{var S;const c=((S=s.value)==null?void 0:S.analyze.rating)||t.article.analyze.rating;return{nice:c.nice,bad:c.bad}});O(()=>{var h;return((h=s.value)==null?void 0:h.analyze.views)||t.article.analyze.views});const m=O(()=>{var S,A;const c=((S=s.value)==null?void 0:S.history.length)||t.article.history.length;return((A=s.value)==null?void 0:A.history[c-1].articleTitle)||t.article.history[c-1].articleTitle}),M=()=>{v.value.isEnterElement=!1};return(c,h)=>{const S=ce("Icon"),A=Ue;return k(),L("div",{onMouseleave:M},[n("div",{onClick:h[0]||(h[0]=j=>g(l(f)))},[n("div",Je,[n("span",et,[n("p",tt,Q(l(i)),1),n("p",rt,Q(l(m)),1)]),n("span",nt,[n("div",st,[n("p",ot,[y(S,{icon:"ic:round-thumb-up-alt",class:"xl:w-[1.2rem] xl:h-[1.2rem] md:w-[1rem] md:h-[1rem] max-md:w-[0.8rem] max-md:h-[0.8rem]"}),re(" "+Q(l(p).nice),1)]),n("p",at,[y(S,{icon:"ic:round-thumb-down-alt",class:"xl:w-[1.2rem] xl:h-[1.2rem] md:w-[1rem] md:h-[1rem] max-md:w-[0.8rem] max-md:h-[0.8rem]"}),re(" "+Q(l(p).bad),1)])]),n("p",null,[y(A,{paramTime:l(w),fromNow:""},null,8,["paramTime"])])])])])],32)}}}),it=["src"],be=.08,ct=me({__name:"followWhatYouSee",props:{imageString:{},imageStringModifiers:{},isEnterElement:{type:Boolean},isEnterElementModifiers:{}},emits:["update:imageString","update:isEnterElement"],setup(e){ke(je);const o=T(),t=te(e,"imageString"),s=te(e,"isEnterElement"),{x:v,y:g}=Ve();let x=0,i=0,f=0,w=0,p;return Se(()=>{const m=()=>{x=v.value,i=g.value,f+=(x-f)*be,w+=(i-w)*be,o.value.style.top="".concat(w,"px"),o.value.style.left="".concat(f,"px"),p=requestAnimationFrame(m)};m()}),We(()=>{cancelAnimationFrame(p)}),(m,M)=>(k(),L("div",{ref_key:"movingDiv",ref:o,class:"absolute -z-10 pointer-events-none select-none"},[n("div",{class:"absolute -z-20 object-cover -translate-1/2 md:w-[202px] max-md:w-[122px] transition-[height] duration-[0.3s] bg-stone-700 mix-blend-difference",style:he({height:s.value?0:"0px"})},null,4),n("img",{src:t.value,class:"object-cover -translate-1/2 md:w-[200px] max-md:w-[120px] transition-[height] duration-[0.3s]",style:he({height:s.value?0:"0px"})},null,12,it)],512))}});var dt=typeof global=="object"&&global&&global.Object===Object&&global,mt=typeof self=="object"&&self&&self.Object===Object&&self,Ee=dt||mt||Function("return this")(),ne=Ee.Symbol,Ie=Object.prototype,ut=Ie.hasOwnProperty,xt=Ie.toString,V=ne?ne.toStringTag:void 0;function ft(e){var o=ut.call(e,V),t=e[V];try{e[V]=void 0;var s=!0}catch(g){}var v=xt.call(e);return s&&(o?e[V]=t:delete e[V]),v}var pt=Object.prototype,vt=pt.toString;function gt(e){return vt.call(e)}var ht="[object Null]",bt="[object Undefined]",ye=ne?ne.toStringTag:void 0;function yt(e){return e==null?e===void 0?bt:ht:ye&&ye in Object(e)?ft(e):gt(e)}function _t(e){return e!=null&&typeof e=="object"}var wt="[object Symbol]";function Tt(e){return typeof e=="symbol"||_t(e)&&yt(e)==wt}var kt=/\s/;function St(e){for(var o=e.length;o--&&kt.test(e.charAt(o)););return o}var jt=/^\s+/;function Et(e){return e&&e.slice(0,St(e)+1).replace(jt,"")}function de(e){var o=typeof e;return e!=null&&(o=="object"||o=="function")}var _e=NaN,It=/^[-+]0x[0-9a-f]+$/i,Ot=/^0b[01]+$/i,Mt=/^0o[0-7]+$/i,zt=parseInt;function we(e){if(typeof e=="number")return e;if(Tt(e))return _e;if(de(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=de(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=Et(e);var t=Ot.test(e);return t||Mt.test(e)?zt(e.slice(2),t?2:8):It.test(e)?_e:+e}var ie=function(){return Ee.Date.now()},$t="Expected a function",Lt=Math.max,At=Math.min;function Te(e,o,t){var s,v,g,x,i,f,w=0,p=!1,m=!1,M=!0;if(typeof e!="function")throw new TypeError($t);o=we(o)||0,de(t)&&(p=!!t.leading,m="maxWait"in t,g=m?Lt(we(t.maxWait)||0,o):g,M="trailing"in t?!!t.trailing:M);function c(a){var b=s,D=v;return s=v=void 0,w=a,x=e.apply(D,b),x}function h(a){return w=a,i=setTimeout(j,o),p?c(a):x}function S(a){var b=a-f,D=a-w,F=o-b;return m?At(F,g-D):F}function A(a){var b=a-f,D=a-w;return f===void 0||b>=o||b<0||m&&D>=g}function j(){var a=ie();if(A(a))return B(a);i=setTimeout(j,S(a))}function B(a){return i=void 0,M&&s?c(a):(s=v=void 0,x)}function W(){i!==void 0&&clearTimeout(i),w=0,s=f=v=i=void 0}function se(){return i===void 0?x:B(ie())}function H(){var a=ie(),b=A(a);if(s=arguments,v=this,f=a,b){if(i===void 0)return h(f);if(m)return clearTimeout(i),i=setTimeout(j,o),c(f)}return i===void 0&&(i=setTimeout(j,o)),x}return H.cancel=W,H.flush=se,H}const Ct={ref:"root"},Dt={class:"[&>div]:xl:first:mt-[100px] [&>div]:md:first:mt-[80px] [&>div]:max-md:first:mt-[60px]"},Nt={class:"xl:flex-2/3 md:flex-3/4"},Rt={class:"border-y border-stone-400 py-5 grid grid-cols-3"},Bt={class:"p-2"},Ft={class:"transImage w-full h-full border relative text-stone-400 border-stone-400 hover:text-stone-700 hover:border-stone-700 flex items-end overflow-hidden xl:h-[120px] md:h-[100px] max-md:h-[70px] after:backdrop-blur-[2px] after:absolute after:content-[''] after:w-full after:h-full after:-z-20"},Ut=["src"],Ht=["src"],Pt={class:"px-2 font-bold max-md:text-[0.8rem]"},Vt={class:"p-2"},Wt={class:"flex"},Yt=["disabled"],Xt=["disabled"],qt={class:"flex-col flex xl:flex-1/3 md:flex-2/4"},Gt={class:"md:sticky md:top-[100px] flex flex-col"},Qt={class:"font-bold xl:text-[6rem] md:text-[3rem] max-md:text-[2rem]"},Kt={class:"px-2"},Zt={class:"flex gap-3 select-none flex-wrap"},Jt={class:"flex"},er={class:"flex"},tr={class:"flex"},rr={class:"flex"},nr={class:"w-[82%] xl:my-10 md:my-5 max-md:my-5 max-md:sticky max-md:top-[100px]"},sr={ref:"searchForm",class:"relative group flex-7/12 flex items-center"},or={class:"absolute group-focus-within:text-stone-700 text-stone-400",for:"s"},ar={class:"xl:flex-2/3 md:flex-2/4"},lr=5,ir=me({__name:"ForumIndex",setup(e){var fe;const o=Ye(),t=Xe({isEnterElement:!1,imageSource:""}),s=ke(je),v=qe(),g=O(()=>v.path.split("/")[1]||"index"),x=T([]),i=T([]),f=T([]),w=async()=>{const d=X(G,"topics");(await q(d)).forEach(u=>{x.value.push({...u.data()})})},p=T(!1),m=T(!0),M=T(null),c=async(d=!1)=>{var r;if(!(p.value||!m.value)){p.value=!0;try{let u;const z=((r=x.value.find(N=>N.name===g.value))==null?void 0:r.articleIDs)||[],E=X(G,"articles"),$=z.slice(0,ue.value);console.log($),d?(i.value=[],M.value=null,m.value=!0,u=ae(E,ge("xid","in",$))):u=ae(E,ge("xid","in",$),De(M.value));const C=await q(u);if(console.log(C.docs),C.empty){m.value=!1,p.value=!1;return}const oe=C.docs[C.docs.length-1];M.value=oe,C.forEach(N=>{i.value.push({...N.data()})})}catch(u){console.error(u)}finally{p.value=!1}}},h=async()=>{if(f.value.length>0)return;const d=X(G,"articles"),r=ae(d,Re("time","desc"),Ne(2));(await q(r)).forEach(z=>{f.value.push({...z.data()})})},S=async()=>{if(!b.value.trim()){p.value=!1,m.value=!0,await c(!0);return}try{p.value=!0,i.value=[];const d=X(G,"articles"),r=await q(d),u=b.value.toLowerCase();r.forEach(z=>{const E={...z.data()},$=E.history.length-1;(E.history[$].articleTitle.toLowerCase().includes(u)||E.history[$].articleHtmlRef.toLowerCase().includes(u))&&i.value.push(E)}),m.value=!1}catch(d){console.error("Error searching articles:",d)}finally{p.value=!1}},A=Te(async()=>{!p.value&&m.value&&await c(!1)},300);Se(async()=>{await w(),c(!0),h()}),K(g,()=>{a.value="order",p.value=!1,m.value=!0,c(!0)});const j=T(1),B=(fe=s==null?void 0:s.value.fetchTopics)!=null?fe:0,W=O(()=>{const d=j.value*B,r=(j.value-1)*B;return{currentMax:d,currentMin:r}}),se=()=>{j.value-=1},H=()=>{j.value+=1},a=T("order");K(a,()=>{Ze(a.value,i.value)});const b=T("");K(b,Te(()=>{S()},500));const D=O(()=>{var u,z;const d=(u=x.value.find(E=>E.name===g.value))!=null?u:null,r=(z=d==null?void 0:d.nickname)!=null?z:"開始聊";return o.topicTitle=r==="同領地"?"開始聊":r,o.articleTitle="",d}),F=T(!1),ue=T(lr),{y:Oe}=Ge(),Me=O(()=>{const d=document.documentElement.scrollHeight,r=window.innerHeight;return{scrollableHeight:d-r,currentScrollY:Oe.value,windowHeight:r}}),xe=O(()=>{const{scrollableHeight:d,currentScrollY:r,windowHeight:u}=Me.value;return!F.value&&r>0&&(F.value=!0),!!(F.value&&d-r<u*.1)});return K(xe,()=>{xe.value&&(ue.value+=5,A())}),(d,r)=>{const u=ct,z=Ae,E=lt,$=Ce,C=Be,oe=ce("router-link"),N=ce("Icon"),ze=Le;return k(),L("div",Ct,[y(u,{isEnterElement:l(t).isEnterElement,"onUpdate:isEnterElement":r[0]||(r[0]=_=>l(t).isEnterElement=_),imageString:l(t).imageSource,"onUpdate:imageString":r[1]||(r[1]=_=>l(t).imageSource=_)},null,8,["isEnterElement","imageString"]),y(z),n("div",Dt,[l(g)==="index"?(k(),le($,{key:0,class:"xl:flex xl:item-start xl:py-20 md:flex md:item-start md:py-10 max-md:flex-col max-md:py-6"},{default:Z(()=>[r[9]||(r[9]=n("h2",{class:"xl:text-[2.5rem] xl:flex-1/3 md:text-[2rem] md:flex-1/4 max-md:text-[1.5rem]"}," 熱門文章 ",-1)),n("div",Nt,[l(f).length>0?(k(!0),L(U,{key:0},J(l(f),_=>(k(),le(E,{reviewImageObject:l(t),"onUpdate:reviewImageObject":r[2]||(r[2]=Y=>R(t)?t.value=Y:null),article:_},null,8,["reviewImageObject","article"]))),256)):(k(),L(U,{key:1},[re(" still loading... ")],64))])]),_:1})):Qe("",!0),y($,{class:"!p-0 !py-10 select-none"},{default:Z(()=>[n("div",Rt,[l(x).length>0?(k(!0),L(U,{key:0},J(l(x).slice(l(W).currentMin,l(W).currentMax),_=>(k(),L("div",Bt,[y(oe,{to:_.path},{default:Z(()=>[n("div",Ft,[n("img",{src:"".concat(_.image),class:"scale-up filter-[var(--imageTrans)] -right-4 -bottom-2 rounded-full absolute z-10w-20 h-20"},null,8,Ut),n("img",{src:"".concat(_.image),class:"scale-up filter-[var(--imageTrans)] -right-8 -bottom-4 rounded-full absolute opacity-20 z-10 w-40 h-40"},null,8,Ht),n("div",Pt,[y(C,{text:_.nickname},null,8,["text"])])])]),_:2},1032,["to"])]))),256)):(k(),L(U,{key:1},J(3,_=>n("div",Vt,r[10]||(r[10]=[n("div",{class:"xl:h-[120px] animate-pulse bg-stone-400 md:h-[100px] max-md:h-[70px]"},null,-1)]))),64))]),n("div",Wt,[n("button",{disabled:l(j)===1,class:"disabled:text-stone-400/50 disabled:cursor-not-allowed not-disabled:cursor-pointer enabled:hover:[&>svg]:-translate-x-10 flex-1/2 flex justify-center border-b border-r border-stone-400 py-1",onClick:se},[y(N,{class:"transition ease-in-out duration-300 transform xl:w-10 xl:h-10",icon:"stash:arrow-left-large-light"})],8,Yt),n("button",{disabled:l(j)>l(x).length/l(B),class:"disabled:text-stone-400/50 disabled:cursor-not-allowed not-disabled:cursor-pointer enabled:hover:[&>svg]:translate-x-10 flex-1/2 flex justify-center border-b border-stone-400 py-1",onClick:H},[y(N,{class:"transition ease-in-out duration-300 transform xl:w-10 xl:h-10",icon:"stash:arrow-right-large-light"})],8,Xt)])]),_:1}),y($,{ref:"root",class:"w-full py-10 xl:flex xl:item-start md:flex md:item-start max-lg:flex-col max-md:flex-col"},{default:Z(()=>{var _,Y,pe,ve;return[n("div",qt,[n("div",Gt,[n("h2",Qt,[y(C,{text:(Y=(_=l(D))==null?void 0:_.nickname)!=null?Y:"/*15a"},null,8,["text"])]),n("div",Kt,[y(C,{text:(ve=(pe=l(D))==null?void 0:pe.description)!=null?ve:"/*13ad|15a"},null,8,["text"])]),n("div",Zt,[n("div",Jt,[P(n("input",{type:"radio",id:"order",name:"msg",value:"order","onUpdate:modelValue":r[3]||(r[3]=I=>R(a)?a.value=I:null),class:"hidden peer"},null,512),[[ee,l(a)]]),r[11]||(r[11]=n("label",{for:"order",class:"border-dashed border-2 border-transparent hover:border-stone-400 flex items-center cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 按順序 ",-1))]),n("div",er,[P(n("input",{type:"radio",id:"newest",name:"msg",value:"newest","onUpdate:modelValue":r[4]||(r[4]=I=>R(a)?a.value=I:null),class:"hidden peer"},null,512),[[ee,l(a)]]),r[12]||(r[12]=n("label",{for:"newest",class:"border-dashed border-2 border-transparent hover:border-stone-400 cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 最新 ",-1))]),n("div",tr,[P(n("input",{type:"radio",id:"mostLiked",name:"mostLiked",value:"mostLiked","onUpdate:modelValue":r[5]||(r[5]=I=>R(a)?a.value=I:null),class:"hidden peer"},null,512),[[ee,l(a)]]),r[13]||(r[13]=n("label",{for:"mostLiked",class:"border-dashed border-2 border-transparent hover:border-stone-400 cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 最多讚 ",-1))]),n("div",rr,[P(n("input",{type:"radio",id:"worst",name:"msg",value:"worst","onUpdate:modelValue":r[6]||(r[6]=I=>R(a)?a.value=I:null),class:"hidden peer"},null,512),[[ee,l(a)]]),r[14]||(r[14]=n("label",{for:"worst",class:"border-dashed border-2 border-transparent hover:border-stone-400 cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 最爛 ",-1))])]),n("div",nr,[n("form",sr,[n("label",or,[y(N,{icon:"ic:baseline-search",class:"xl:w-6 xl:h-6 md:w-4.5 md:h-4.5 max-md:w-4 max-md:h-4"})]),P(n("input",{"onUpdate:modelValue":r[7]||(r[7]=I=>R(b)?b.value=I:null),type:"text",id:"s",placeholder:"文章搜尋...",class:"w-full xl:px-7 xl:h-10 xl:text-[1.2rem] md:px-5 md:h-8 md:text-[1rem] max-md:px-5 max-md:h-5 max-md:text-[1rem] outline-none bg-none border-b border-transparent relative border-b-stone-400 focus:border-b-stone-700"},null,512),[[Ke,l(b)]])],512)])])]),n("div",ar,[l(i).length>0?(k(!0),L(U,{key:0},J(l(i),I=>(k(),le(E,{key:I.xid,ref_for:!0,ref:"currentArticleScroll",reviewImageObject:l(t),"onUpdate:reviewImageObject":r[8]||(r[8]=$e=>R(t)?t.value=$e:null),article:I},null,8,["reviewImageObject","article"]))),128)):(k(),L(U,{key:1},[re(" still loading... ")],64))])]}),_:1},512)]),y(ze)],512)}}}),fr=Fe(ir,[["__scopeId","data-v-007fd147"]]);export{fr as default};
