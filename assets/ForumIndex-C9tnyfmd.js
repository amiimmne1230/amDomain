import{_ as Oe}from"./SiteScroll.vue_vue_type_script_setup_true_lang-CUkLtcOL.js";import{a as Se,b as Me,e as q,f as K,D as Q,q as ne,w as fe,i as $e,l as Ce,o as Le,c as Ee}from"./NavigationTempl.vue_vue_type_script_setup_true_lang-DkFuexi7.js";import{_ as Ae}from"./DomainTime.vue_vue_type_script_setup_true_lang-DH1GQiNu.js";import{d as _e,y as Ne,i as pe,r as k,c as S,a as C,e as r,u as o,t as X,f as h,V as re,j as ae,K as Re,b as j,g as De,W as He,X as Be,J as Ve,o as Pe,D as J,Y as Ue,H as ze,A as Z,Z as Fe,F as V,C as ee,z as ve,E as D,G as F,I as te,U as We}from"./index-JA71XfTj.js";import{s as Ge}from"./useArticle-DDZ4qhw5.js";var Ye=typeof global=="object"&&global&&global.Object===Object&&global,qe=typeof self=="object"&&self&&self.Object===Object&&self,we=Ye||qe||Function("return this")(),se=we.Symbol,Te=Object.prototype,Ke=Te.hasOwnProperty,Qe=Te.toString,W=se?se.toStringTag:void 0;function Xe(e){var l=Ke.call(e,W),n=e[W];try{e[W]=void 0;var d=!0}catch(y){}var I=Qe.call(e);return d&&(l?e[W]=n:delete e[W]),I}var Je=Object.prototype,Ze=Je.toString;function et(e){return Ze.call(e)}var tt="[object Null]",rt="[object Undefined]",he=se?se.toStringTag:void 0;function st(e){return e==null?e===void 0?rt:tt:he&&he in Object(e)?Xe(e):et(e)}function ot(e){return e!=null&&typeof e=="object"}var nt="[object Symbol]";function lt(e){return typeof e=="symbol"||ot(e)&&st(e)==nt}var at=/\s/;function it(e){for(var l=e.length;l--&&at.test(e.charAt(l)););return l}var ct=/^\s+/;function dt(e){return e&&e.slice(0,it(e)+1).replace(ct,"")}function ie(e){var l=typeof e;return e!=null&&(l=="object"||l=="function")}var be=NaN,mt=/^[-+]0x[0-9a-f]+$/i,ut=/^0b[01]+$/i,xt=/^0o[0-7]+$/i,ft=parseInt;function ge(e){if(typeof e=="number")return e;if(lt(e))return be;if(ie(e)){var l=typeof e.valueOf=="function"?e.valueOf():e;e=ie(l)?l+"":l}if(typeof e!="string")return e===0?e:+e;e=dt(e);var n=ut.test(e);return n||xt.test(e)?ft(e.slice(2),n?2:8):mt.test(e)?be:+e}var le=function(){return we.Date.now()},pt="Expected a function",vt=Math.max,ht=Math.min;function ye(e,l,n){var d,I,y,x,i,b,L=0,f=!1,p=!1,E=!0;if(typeof e!="function")throw new TypeError(pt);l=ge(l)||0,ie(n)&&(f=!!n.leading,p="maxWait"in n,y=p?vt(ge(n.maxWait)||0,l):y,E="trailing"in n?!!n.trailing:E);function a(s){var v=d,N=I;return d=I=void 0,L=s,x=e.apply(N,v),x}function u(s){return L=s,i=setTimeout(w,l),f?a(s):x}function _(s){var v=s-b,N=s-L,B=l-v;return p?ht(B,y-N):B}function A(s){var v=s-b,N=s-L;return b===void 0||v>=l||v<0||p&&N>=y}function w(){var s=le();if(A(s))return H(s);i=setTimeout(w,_(s))}function H(s){return i=void 0,E&&d?a(s):(d=I=void 0,x)}function G(){i!==void 0&&clearTimeout(i),L=0,d=b=I=i=void 0}function oe(){return i===void 0?x:H(le())}function P(){var s=le(),v=A(s);if(d=arguments,I=this,b=s,v){if(i===void 0)return u(b);if(p)return clearTimeout(i),i=setTimeout(w,l),a(b)}return i===void 0&&(i=setTimeout(w,l)),x}return P.cancel=G,P.flush=oe,P}const bt={class:"border-b w-full flex items-end font-bold cursor-pointer border-stone-400 text-stone-400 hover:mix-blend-difference"},gt={class:"xl:pt-2 md:pt-1 max-md:pt-0.5"},yt={class:"break-all line-clamp-2 text-stone-400/50 xl:w-80 xl:text-lg <!-- 原 calc(1.25rem*20) = 25rem → w-80 (320px) --> md:w-64 md:text-base <!-- calc(1rem*20) = 20rem → w-64 (256px) --> max-md:max-w-48 max-md:text-[8px]"},_t={class:"break-all line-clamp-2 xl:w-96 xl:text-lg <!-- calc(1.5rem*20) = 30rem → w-96 (384px) --> md:w-64 md:text-base max-md:max-w-[calc(1rem*8)] max-md:text-[12px]"},wt={class:"flex flex-col ml-auto xl:text-xl md:text-base max-md:text-[8px]"},Tt={class:"flex justify-end gap-5"},kt={class:"flex gap-1 items-center"},jt={class:"flex gap-1 items-center"},It=_e({__name:"ReviewArticleTempl",props:Ne({article:{}},{forumTemplModels:{},forumTemplModelsModifiers:{},reviewImageObject:{},reviewImageObjectModifiers:{}}),emits:["update:forumTemplModels","update:reviewImageObject"],setup(e){const l=Re(),n=e,d=pe(e,"forumTemplModels"),I=pe(e,"reviewImageObject"),y=a=>{l.push({path:a})},x=k(""),i=S(()=>{var a;return((a=d.value)==null?void 0:a.alias)||n.article.alias}),b=S(()=>{var a,u;return x.value=((a=d.value)==null?void 0:a.path)||n.article.path,((u=d.value)==null?void 0:u.path)||n.article.path}),L=S(()=>{var u;return((u=d.value)==null?void 0:u.time)||n.article.time}),f=S(()=>{var _;const a=((_=d.value)==null?void 0:_.analyze.rating)||n.article.analyze.rating;return{nice:a.nice,bad:a.bad}});S(()=>{var u;return((u=d.value)==null?void 0:u.analyze.views)||n.article.analyze.views});const p=S(()=>{var _,A;const a=((_=d.value)==null?void 0:_.history.length)||n.article.history.length;return((A=d.value)==null?void 0:A.history[a-1].articleTitle)||n.article.history[a-1].articleTitle}),E=()=>{I.value.isEnterElement=!1};return(a,u)=>{const _=ae("Icon"),A=Ae;return j(),C("div",{onMouseleave:E},[r("div",{onClick:u[0]||(u[0]=w=>y(o(b)))},[r("div",bt,[r("span",gt,[r("p",yt,X(o(i)),1),r("p",_t,X(o(p)),1)]),r("span",wt,[r("div",Tt,[r("p",kt,[h(_,{icon:"ic:round-thumb-up-alt",class:"xl:w-5 xl:h-5 md:w-4 md:h-4 max-md:w-3 max-md:h-3"}),re(" "+X(o(f).nice),1)]),r("p",jt,[h(_,{icon:"ic:round-thumb-down-alt",class:"xl:w-5 xl:h-5 md:w-4 md:h-4 max-md:w-3 max-md:h-3"}),re(" "+X(o(f).bad),1)])]),r("p",null,[h(A,{paramTime:o(L),fromNow:""},null,8,["paramTime"])])])])])],32)}}}),Ot={ref:"root"},St={key:0,class:"xl:mt-25 md:mt-20 max-md:mt-15"},Mt={class:"xl:flex-2/3 md:flex-3/4"},$t={class:"border-y border-stone-400 py-5 grid grid-cols-3"},Ct={class:"p-2"},Lt={class:"transImage w-full h-full border relative text-stone-400 border-stone-400 hover:text-stone-700 hover:border-stone-700 flex items-end overflow-hidden xl:h-[120px] md:h-[100px] max-md:h-[70px] after:backdrop-blur-[2px] after:absolute after:content-[''] after:w-full after:h-full after:-z-20"},Et=["src"],At=["src"],Nt={class:"px-2 font-bold max-md:text-[0.8rem]"},Rt={class:"p-2"},Dt={class:"flex"},Ht=["disabled"],Bt=["disabled"],Vt={class:"flex-col flex xl:flex-1/3 md:flex-2/4"},Pt={class:"md:sticky md:top-[100px] flex flex-col"},Ut={class:"font-bold xl:text-[6rem] md:text-[3rem] max-md:text-[2rem]"},zt={class:"md:text-[1rem] max-md:text-[0.75rem] max-md:mb-2"},Ft={class:"flex gap-3 select-none flex-wrap"},Wt={class:"flex"},Gt={class:"flex"},Yt={class:"flex"},qt={class:"flex"},Kt={class:"w-[82%] xl:my-10 md:my-5 max-md:my-5 max-md:sticky max-md:top-[100px]"},Qt={ref:"searchForm",class:"relative group flex-7/12 flex items-center"},Xt={class:"absolute group-focus-within:text-stone-700 text-stone-400",for:"s"},Jt={class:"xl:flex-2/3 md:flex-2/4"},Zt=5,nr=_e({__name:"ForumIndex",setup(e){var me;const l=De(),n=He({isEnterElement:!1,imageSource:""}),d=Be(Fe),I=Ve(),y=S(()=>I.path.split("/")[1]||"index"),x=k([]),i=k([]),b=k([]),L=async()=>{const c=q(Q,"topics");(await K(c)).forEach(m=>{x.value.push({...m.data()})})},f=k(!1),p=k(!0),E=k(null),a=async(c=!1)=>{var t;if(!(f.value||!p.value)){f.value=!0;try{let m;const O=((t=x.value.find(z=>z.name===y.value))==null?void 0:t.articleIDs)||[],g=q(Q,"articles"),M=O.slice(0,ce.value);console.log(M),c?(i.value=[],E.value=null,p.value=!0,m=ne(g,fe("xid","in",M))):m=ne(g,fe("xid","in",M),$e(E.value));const R=await K(m);if(console.log(R.docs),R.empty){p.value=!1,f.value=!1;return}const U=R.docs[R.docs.length-1];E.value=U,R.forEach(z=>{i.value.push({...z.data()})})}catch(m){console.error(m)}finally{f.value=!1}}},u=async()=>{if(b.value.length>0)return;const c=q(Q,"articles"),t=ne(c,Le("time","desc"),Ce(2));(await K(t)).forEach(O=>{b.value.push({...O.data()})})},_=async()=>{if(!v.value.trim()){f.value=!1,p.value=!0,await a(!0);return}try{f.value=!0,i.value=[];const c=q(Q,"articles"),t=await K(c),m=v.value.toLowerCase();t.forEach(O=>{const g={...O.data()},M=g.history.length-1;(g.history[M].articleTitle.toLowerCase().includes(m)||g.history[M].articleHtmlRef.toLowerCase().includes(m))&&i.value.push(g)}),p.value=!1}catch(c){console.error("Error searching articles:",c)}finally{f.value=!1}},A=ye(async()=>{!f.value&&p.value&&await a(!1)},300);Pe(async()=>{await L(),a(!0),u()}),J(y,()=>{s.value="order",f.value=!1,p.value=!0,a(!0)});const w=k(1),H=(me=d==null?void 0:d.value.fetchTopics)!=null?me:0,G=S(()=>{const c=w.value*H,t=(w.value-1)*H;return{currentMax:c,currentMin:t}}),oe=()=>{w.value-=1},P=()=>{w.value+=1},s=k("order");J(s,()=>{Ge(s.value,i.value)});const v=k("");J(v,ye(()=>{_()},500));const N=S(()=>{var m,O;const c=(m=x.value.find(g=>g.name===y.value))!=null?m:null,t=(O=c==null?void 0:c.nickname)!=null?O:"開始聊";return l.topicTitle=t==="同領地"?"開始聊":t,l.articleTitle="",c}),B=k(!1),ce=k(Zt),{y:ke}=Ue(),je=S(()=>{const c=document.documentElement.scrollHeight,t=window.innerHeight;return{scrollableHeight:c-t,currentScrollY:ke.value,windowHeight:t}}),de=S(()=>{const{scrollableHeight:c,currentScrollY:t,windowHeight:m}=je.value;return!B.value&&t>0&&(B.value=!0),!!(B.value&&c-t<m*.1)});return J(de,()=>{de.value&&(ce.value+=5,A())}),(c,t)=>{const m=Se,O=It,g=Me,M=Ee,R=ae("router-link"),U=ae("Icon"),z=Oe;return j(),C("div",Ot,[h(m),o(y)==="index"?(j(),C("div",St,[h(g,{class:"xl:flex xl:item-start xl:py-20 md:flex md:item-start md:py-10 max-md:flex-col max-md:py-6"},{default:Z(()=>[t[7]||(t[7]=r("h2",{class:"xl:text-[2.5rem] xl:flex-1/3 md:text-[2rem] md:flex-1/4 max-md:text-[1.5rem]"}," 熱門文章 ",-1)),r("div",Mt,[o(b).length>0?(j(!0),C(V,{key:0},ee(o(b),$=>(j(),ve(O,{reviewImageObject:o(n),"onUpdate:reviewImageObject":t[0]||(t[0]=Y=>D(n)?n.value=Y:null),article:$},null,8,["reviewImageObject","article"]))),256)):(j(),C(V,{key:1},[re(" still loading... ")],64))])]),_:1})])):ze("",!0),h(g,{class:"!p-0 !py-10 select-none"},{default:Z(()=>[r("div",$t,[o(x).length>0?(j(!0),C(V,{key:0},ee(o(x).slice(o(G).currentMin,o(G).currentMax),$=>(j(),C("div",Ct,[h(R,{to:$.path},{default:Z(()=>[r("div",Lt,[r("img",{src:"./".concat($.image),class:"scale-up filter-[var(--imageTrans)] -right-4 -bottom-2 rounded-full absolute z-10w-20 h-20"},null,8,Et),r("img",{src:"./".concat($.image),class:"scale-up filter-[var(--imageTrans)] -right-8 -bottom-4 rounded-full absolute opacity-20 z-10 w-40 h-40"},null,8,At),r("div",Nt,[h(M,{text:$.nickname},null,8,["text"])])])]),_:2},1032,["to"])]))),256)):(j(),C(V,{key:1},ee(3,$=>r("div",Rt,t[8]||(t[8]=[r("div",{class:"xl:h-[120px] animate-pulse bg-stone-400 md:h-[100px] max-md:h-[70px]"},null,-1)]))),64))]),r("div",Dt,[r("button",{disabled:o(w)===1,class:"disabled:text-stone-400/50 disabled:cursor-not-allowed not-disabled:cursor-pointer enabled:hover:[&>svg]:-translate-x-10 flex-1/2 flex justify-center border-b border-r border-stone-400 py-1",onClick:oe},[h(U,{class:"transition ease-in-out duration-300 transform xl:w-10 xl:h-10",icon:"stash:arrow-left-large-light"})],8,Ht),r("button",{disabled:o(w)>o(x).length/o(H),class:"disabled:text-stone-400/50 disabled:cursor-not-allowed not-disabled:cursor-pointer enabled:hover:[&>svg]:translate-x-10 flex-1/2 flex justify-center border-b border-stone-400 py-1",onClick:P},[h(U,{class:"transition ease-in-out duration-300 transform xl:w-10 xl:h-10",icon:"stash:arrow-right-large-light"})],8,Bt)])]),_:1}),h(g,{ref:"root",class:"w-full py-10 xl:flex xl:item-start md:flex md:item-start max-lg:flex-col max-md:flex-col"},{default:Z(()=>{var $,Y,ue,xe;return[r("div",Vt,[r("div",Pt,[r("h2",Ut,[h(M,{text:(Y=($=o(N))==null?void 0:$.nickname)!=null?Y:"/*15a"},null,8,["text"])]),r("div",zt,[h(M,{text:(xe=(ue=o(N))==null?void 0:ue.description)!=null?xe:"/*13ad|15a"},null,8,["text"])]),r("div",Ft,[r("div",Wt,[F(r("input",{type:"radio",id:"order",name:"msg",value:"order","onUpdate:modelValue":t[1]||(t[1]=T=>D(s)?s.value=T:null),class:"hidden peer"},null,512),[[te,o(s)]]),t[9]||(t[9]=r("label",{for:"order",class:"border-dashed border-2 border-transparent hover:border-stone-400 flex items-center cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 按順序 ",-1))]),r("div",Gt,[F(r("input",{type:"radio",id:"newest",name:"msg",value:"newest","onUpdate:modelValue":t[2]||(t[2]=T=>D(s)?s.value=T:null),class:"hidden peer"},null,512),[[te,o(s)]]),t[10]||(t[10]=r("label",{for:"newest",class:"border-dashed border-2 border-transparent hover:border-stone-400 cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 最新 ",-1))]),r("div",Yt,[F(r("input",{type:"radio",id:"mostLiked",name:"mostLiked",value:"mostLiked","onUpdate:modelValue":t[3]||(t[3]=T=>D(s)?s.value=T:null),class:"hidden peer"},null,512),[[te,o(s)]]),t[11]||(t[11]=r("label",{for:"mostLiked",class:"border-dashed border-2 border-transparent hover:border-stone-400 cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 最多讚 ",-1))]),r("div",qt,[F(r("input",{type:"radio",id:"worst",name:"msg",value:"worst","onUpdate:modelValue":t[4]||(t[4]=T=>D(s)?s.value=T:null),class:"hidden peer"},null,512),[[te,o(s)]]),t[12]||(t[12]=r("label",{for:"worst",class:"border-dashed border-2 border-transparent hover:border-stone-400 cursor-pointer text-stone-400 peer-checked:bg-stone-400 peer-checked:text-white rounded-full xl:py-1 xl:px-4 xl:text-[1rem] md:py-1 md:px-3 md:text-[0.8rem] max-md:py-0.5 max-md:px-2 max-md:text-[0.75rem]"}," 最爛 ",-1))])]),r("div",Kt,[r("form",Qt,[r("label",Xt,[h(U,{icon:"ic:baseline-search",class:"xl:w-6 xl:h-6 md:w-4.5 md:h-4.5 max-md:w-4 max-md:h-4"})]),F(r("input",{"onUpdate:modelValue":t[5]||(t[5]=T=>D(v)?v.value=T:null),type:"text",id:"s",placeholder:"文章搜尋...",class:"w-full xl:px-7 xl:h-10 xl:text-[1.2rem] md:px-5 md:h-8 md:text-[1rem] max-md:px-5 max-md:h-5 max-md:text-[1rem] outline-none bg-none border-b border-transparent relative border-b-stone-400 focus:border-b-stone-700"},null,512),[[We,o(v)]])],512)])])]),r("div",Jt,[o(i).length>0?(j(!0),C(V,{key:0},ee(o(i),T=>(j(),ve(O,{key:T.xid,ref_for:!0,ref:"currentArticleScroll",reviewImageObject:o(n),"onUpdate:reviewImageObject":t[6]||(t[6]=Ie=>D(n)?n.value=Ie:null),article:T},null,8,["reviewImageObject","article"]))),128)):(j(),C(V,{key:1},[re(" still loading... ")],64))])]}),_:1},512),h(z)],512)}}});export{nr as default};
