var _t=Object.defineProperty;var qt=(s,t,e)=>t in s?_t(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var _=(s,t,e)=>qt(s,typeof t!="symbol"?t+"":t,e);import{D as It,a as zt,b as Vt,_ as Gt,c as Yt,d as Kt,e as ot,P as at,f as lt,N as A,T as Zt,S as Qt,F as jt,h as Xt,i as te,E as ee,j as ht,k as ne}from"./TipTap_Extensions-NAWQ57LC.js";import{d as xt,M as re,s as se,r as F,p as ie,m as oe,u as st,N as ae,O as le,P as ce,Q as tt,i as St,c as G,R as ue,g as bt,h as he,o as fe,z as de,n as pe,K as me,b as Dt,a as ge,f as K,e as q,A as Et,F as xe}from"./index-ckjO0zia.js";import{i as we,r as ye,u as Se,A as L}from"./Constant-BobRPnoL.js";import{_ as Ee,a as Te,b as ve,c as Oe}from"./NavigationTempl.vue_vue_type_script_setup_true_lang-BzrcWIbz.js";const Ne=Object.freeze(Object.defineProperty({__proto__:null,Decoration:It,DecorationSet:zt,EditorView:Vt,__endComposition:Gt,__parseFromClipboard:Yt},Symbol.toStringTag,{value:"Module"}));function Tt(s){return ce((t,e)=>({get(){return t(),s},set(n){s=n,requestAnimationFrame(()=>{requestAnimationFrame(()=>{e()})})}}))}class ke extends Kt{constructor(t={}){return super(t),this.contentComponent=null,this.appContext=null,this.reactiveState=Tt(this.view.state),this.reactiveExtensionStorage=Tt(this.extensionStorage),this.on("beforeTransaction",({nextState:e})=>{this.reactiveState.value=e,this.reactiveExtensionStorage.value=this.extensionStorage}),re(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(t,e){const n=super.registerPlugin(t,e);return this.reactiveState&&(this.reactiveState.value=n),n}unregisterPlugin(t){const e=super.unregisterPlugin(t);return this.reactiveState&&e&&(this.reactiveState.value=e),e}}const Ce=xt({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(s){const t=F(),e=ae();return ie(()=>{const n=s.editor;n&&n.options.element&&t.value&&oe(()=>{if(!t.value||!n.options.element.firstChild)return;const r=st(t.value);t.value.append(...n.options.element.childNodes),n.contentComponent=e.ctx._,e&&(n.appContext={...e.appContext,provides:e.provides}),n.setOptions({element:r}),n.createNodeViews()})}),le(()=>{const n=s.editor;n&&(n.contentComponent=null,n.appContext=null)}),{rootEl:t}},render(){return se("div",{ref:s=>{this.rootEl=s}})}});function Ie(){try{return Ne}catch(s){return null}}function ze(s,t){if(s&&typeof s.serializeForClipboard=="function")return s.serializeForClipboard(t);const e=Ie();if(e&&typeof(e==null?void 0:e.__serializeForClipboard)=="function")return e.__serializeForClipboard(s,t);throw new Error("No supported clipboard serialization method found.")}function be(s){const t=s.getBoundingClientRect(),e=s.closest('[role="dialog"]');if(e&&window.getComputedStyle(e).transform!=="none"){const n=e.getBoundingClientRect();return{top:t.top-n.top,left:t.left-n.left,width:t.width}}return{top:t.top,left:t.left,width:t.width}}function vt(s,t){const e=["li","p:not(:first-child)","pre","blockquote","h1","h2","h3","h4","h5","h6",...t.customNodes.map(n=>"[data-type=".concat(n,"]"))].join(", ");return document.elementsFromPoint(s.x,s.y).find(n=>{var r,o;return((o=(r=n.parentElement)==null?void 0:r.matches)==null?void 0:o.call(r,".ProseMirror"))||n.matches(e)})}function De(s,t,e){var r;const n=s.getBoundingClientRect();return(r=t.posAtCoords({left:n.left+50+e.dragHandleWidth,top:n.top+1}))==null?void 0:r.inside}function Ot(s,t){const e=t.state.doc.resolve(s);return e.depth>1?e.before(e.depth):s}function Re(s){let t="";function e(i,l){if(l.focus(),!i.dataTransfer)return;const c=vt({x:i.clientX+50+s.dragHandleWidth,y:i.clientY},s);if(!(c instanceof Element))return;let u=De(c,l,s);if(u==null||u<0)return;u=Ot(u,l);const{from:p,to:y}=l.state.selection,E=p-y,k=Ot(p,l);let m=!1;const O=l.state.doc.resolve(k);if(O.node().type.name==="doc")m=!0;else{const S=A.create(l.state.doc,O.before());m=!(u+1>=S.$from.pos&&u<=S.$to.pos)}let b=l.state.selection;if(!m&&E!==0&&!(l.state.selection instanceof A)){const S=A.create(l.state.doc,y-1);b=Zt.create(l.state.doc,u,S.$to.pos)}else if(b=A.create(l.state.doc,u),b.node.type.isInline||b.node.type.name==="tableRow"){let S=l.state.doc.resolve(b.from);b=A.create(l.state.doc,S.before())}l.dispatch(l.state.tr.setSelection(b)),l.state.selection instanceof A&&l.state.selection.node.type.name==="listItem"&&(t=c.parentElement.tagName);const W=l.state.selection.content(),{dom:h,text:f}=ze(l,W);i.dataTransfer.clearData(),i.dataTransfer.setData("text/html",h.innerHTML),i.dataTransfer.setData("text/plain",f),i.dataTransfer.effectAllowed="copyMove",i.dataTransfer.setDragImage(c,0,0),l.dragging={slice:W,move:i.ctrlKey}}let n=null;function r(){n&&n.classList.add("hide")}function o(){n&&n.classList.remove("hide")}function a(i){if(i.target instanceof Element){const l=i.relatedTarget;if((l==null?void 0:l.classList.contains("tiptap"))||(l==null?void 0:l.classList.contains("drag-handle")))return}r()}return new at({key:new lt(s.pluginKey),view:i=>{var p,y,E,k;const l=s.dragHandleSelector?document.querySelector(s.dragHandleSelector):null;n=l!=null?l:document.createElement("div"),n.draggable=!0,n.dataset.dragHandle="",n.classList.add("drag-handle");function c(m){e(m,i)}n.addEventListener("dragstart",c);function u(m){r();let O=window.scrollY;m.clientY<s.scrollTreshold?window.scrollTo({top:O-30,behavior:"smooth"}):window.innerHeight-m.clientY<s.scrollTreshold&&window.scrollTo({top:O+30,behavior:"smooth"})}return n.addEventListener("drag",u),r(),l||(y=(p=i==null?void 0:i.dom)==null?void 0:p.parentElement)==null||y.appendChild(n),(k=(E=i==null?void 0:i.dom)==null?void 0:E.parentElement)==null||k.addEventListener("mouseout",a),{destroy:()=>{var m,O,b;l||(m=n==null?void 0:n.remove)==null||m.call(n),n==null||n.removeEventListener("drag",u),n==null||n.removeEventListener("dragstart",c),n=null,(b=(O=i==null?void 0:i.dom)==null?void 0:O.parentElement)==null||b.removeEventListener("mouseout",a)}}},props:{handleDOMEvents:{mousemove:(i,l)=>{if(!i.editable)return;const c=vt({x:l.clientX+50+s.dragHandleWidth,y:l.clientY},s),u=c==null?void 0:c.closest(".not-draggable"),p=s.excludedTags.concat(["ol","ul"]).join(", ");if(!(c instanceof Element)||c.matches(p)||u){r();return}const y=window.getComputedStyle(c),E=parseInt(y.lineHeight,10),k=isNaN(E)?parseInt(y.fontSize)*1.2:E,m=parseInt(y.paddingTop,10),O=be(c);O.top+=(k-24)/2,O.top+=m,c.matches("ul:not([data-type=taskList]) li, ol li")&&(O.left-=s.dragHandleWidth),O.width=s.dragHandleWidth,n&&(n.style.left="".concat(O.left-O.width,"px"),n.style.top="".concat(O.top,"px"),o())},keydown:()=>{r()},mousewheel:()=>{r()},dragstart:i=>{i.dom.classList.add("dragging")},drop:(i,l)=>{var E;i.dom.classList.remove("dragging"),r();let c=null;const u=i.posAtCoords({left:l.clientX,top:l.clientY});if(!u||(i.state.selection instanceof A&&(c=i.state.selection.node),!c))return;const y=i.state.doc.resolve(u.pos).parent.type.name==="listItem";if(i.state.selection instanceof A&&i.state.selection.node.type.name==="listItem"&&!y&&t=="OL"){const k=(E=i.state.schema.nodes.orderedList)==null?void 0:E.createAndFill(null,c),m=new Qt(jt.from(k),0,0);i.dragging={slice:m,move:l.ctrlKey}}},dragend:i=>{i.dom.classList.remove("dragging")}}}})}const Ae=ot.create({name:"globalDragHandle",addOptions(){return{dragHandleWidth:20,scrollTreshold:100,excludedTags:[],customNodes:[]}},addProseMirrorPlugins(){return[Re({pluginKey:"globalDragHandle",dragHandleWidth:this.options.dragHandleWidth,scrollTreshold:this.options.scrollTreshold,dragHandleSelector:this.options.dragHandleSelector,excludedTags:this.options.excludedTags,customNodes:this.options.customNodes})]}});function Rt(s,t,e){for(let n=0;;n++){if(n==s.childCount||n==t.childCount)return s.childCount==t.childCount?null:e;let r=s.child(n),o=t.child(n);if(r==o){e+=r.nodeSize;continue}if(!r.sameMarkup(o))return e;if(r.isText&&r.text!=o.text){for(let a=0;r.text[a]==o.text[a];a++)e++;return e}if(r.content.size||o.content.size){let a=Rt(r.content,o.content,e+1);if(a!=null)return a}e+=r.nodeSize}}function At(s,t,e,n){for(let r=s.childCount,o=t.childCount;;){if(r==0||o==0)return r==o?null:{a:e,b:n};let a=s.child(--r),i=t.child(--o),l=a.nodeSize;if(a==i){e-=l,n-=l;continue}if(!a.sameMarkup(i))return{a:e,b:n};if(a.isText&&a.text!=i.text){let c=0,u=Math.min(a.text.length,i.text.length);for(;c<u&&a.text[a.text.length-c-1]==i.text[i.text.length-c-1];)c++,e--,n--;return{a:e,b:n}}if(a.content.size||i.content.size){let c=At(a.content,i.content,e-1,n-1);if(c)return c}e-=l,n-=l}}class w{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,r=0,o){for(let a=0,i=0;i<e;a++){let l=this.content[a],c=i+l.nodeSize;if(c>t&&n(l,r+i,o||null,a)!==!1&&l.content.size){let u=i+1;l.nodesBetween(Math.max(0,t-u),Math.min(l.content.size,e-u),n,r+u)}i=c}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,r){let o="",a=!0;return this.nodesBetween(t,e,(i,l)=>{let c=i.isText?i.text.slice(Math.max(t,l)-l,e-l):i.isLeaf?r?typeof r=="function"?r(i):r:i.type.spec.leafText?i.type.spec.leafText(i):"":"";i.isBlock&&(i.isLeaf&&c||i.isTextblock)&&n&&(a?a=!1:o+=n),o+=c},0),o}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new w(r,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let n=[],r=0;if(e>t)for(let o=0,a=0;a<e;o++){let i=this.content[o],l=a+i.nodeSize;l>t&&((a<t||l>e)&&(i.isText?i=i.cut(Math.max(0,t-a),Math.min(i.text.length,e-a)):i=i.cut(Math.max(0,t-a-1),Math.min(i.content.size,e-a-1))),n.push(i),r+=i.nodeSize),a=l}return new w(n,r)}cutByIndex(t,e){return t==e?w.empty:t==0&&e==this.content.length?this:new w(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new w(r,o)}addToStart(t){return new w([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new w(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let r=this.content[e];t(r,n,e),n+=r.nodeSize}}findDiffStart(t,e=0){return Rt(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return At(this,t,e,n)}findIndex(t,e=-1){if(t==0)return et(0,t);if(t==this.size)return et(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position ".concat(t," outside of fragment (").concat(this,")"));for(let n=0,r=0;;n++){let o=this.child(n),a=r+o.nodeSize;if(a>=t)return a==t||e>0?et(n+1,a):et(n,r);r=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return w.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new w(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return w.empty;let e,n=0;for(let r=0;r<t.length;r++){let o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new w(e||t,n)}static from(t){if(!t)return w.empty;if(t instanceof w)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new w([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}w.empty=new w([],0);const ft={index:0,offset:0};function et(s,t){return ft.index=s,ft.offset=t,ft}class Je extends Error{}class v{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=Mt(this.content,t+this.openStart,e);return n&&new v(n,this.openStart,this.openEnd)}removeBetween(t,e){return new v(Jt(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return v.empty;let n=e.openStart||0,r=e.openEnd||0;if(typeof n!="number"||typeof r!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new v(w.fromJSON(t,e.content),n,r)}static maxOpen(t,e=!0){let n=0,r=0;for(let o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(let o=t.lastChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.lastChild)r++;return new v(t,n,r)}}v.empty=new v(w.empty,0,0);function Jt(s,t,e){let{index:n,offset:r}=s.findIndex(t),o=s.maybeChild(n),{index:a,offset:i}=s.findIndex(e);if(r==t||o.isText){if(i!=e&&!s.child(a).isText)throw new RangeError("Removing non-flat range");return s.cut(0,t).append(s.cut(e))}if(n!=a)throw new RangeError("Removing non-flat range");return s.replaceChild(n,o.copy(Jt(o.content,t-r-1,e-r-1)))}function Mt(s,t,e,n){let{index:r,offset:o}=s.findIndex(t),a=s.maybeChild(r);if(o==t||a.isText)return s.cut(0,t).append(e).append(s.cut(t));let i=Mt(a.content,t-o-1,e);return i&&s.replaceChild(r,a.copy(i))}const Pt=65535,Lt=Math.pow(2,16);function Me(s,t){return s+t*Lt}function Nt(s){return s&Pt}function Pe(s){return(s-(s&Pt))/Lt}const Ft=1,Bt=2,rt=4,Ht=8;class kt{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(this.delInfo&Ht)>0}get deletedBefore(){return(this.delInfo&(Ft|rt))>0}get deletedAfter(){return(this.delInfo&(Bt|rt))>0}get deletedAcross(){return(this.delInfo&rt)>0}}class z{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&z.empty)return z.empty}recover(t){let e=0,n=Nt(t);if(!this.inverted)for(let r=0;r<n;r++)e+=this.ranges[r*3+2]-this.ranges[r*3+1];return this.ranges[n*3]+e+Pe(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let r=0,o=this.inverted?2:1,a=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let l=this.ranges[i]-(this.inverted?r:0);if(l>t)break;let c=this.ranges[i+o],u=this.ranges[i+a],p=l+c;if(t<=p){let y=c?t==l?-1:t==p?1:e:e,E=l+r+(y<0?0:u);if(n)return E;let k=t==(e<0?l:p)?null:Me(i/3,t-l),m=t==l?Bt:t==p?Ft:rt;return(e<0?t!=l:t!=p)&&(m|=Ht),new kt(E,m,k)}r+=u-c}return n?t+r:new kt(t+r,0,null)}touches(t,e){let n=0,r=Nt(e),o=this.inverted?2:1,a=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let l=this.ranges[i]-(this.inverted?n:0);if(l>t)break;let c=this.ranges[i+o],u=l+c;if(t<=u&&i==r*3)return!0;n+=this.ranges[i+a]-c}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,o=0;r<this.ranges.length;r+=3){let a=this.ranges[r],i=a-(this.inverted?o:0),l=a+(this.inverted?0:o),c=this.ranges[r+e],u=this.ranges[r+n];t(i,i+c,l,l+u),o+=u-c}}invert(){return new z(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?z.empty:new z(t<0?[0,-t,0]:[0,0,t])}}z.empty=new z([]);const dt=Object.create(null);class C{getMap(){return z.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=dt[e.stepType];if(!n)throw new RangeError("No step type ".concat(e.stepType," defined"));return n.fromJSON(t,e)}static jsonID(t,e){if(t in dt)throw new RangeError("Duplicate use of step JSON ID "+t);return dt[t]=e,e.prototype.jsonID=t,e}}class T{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new T(t,null)}static fail(t){return new T(null,t)}static fromReplace(t,e,n,r){try{return T.ok(t.replace(e,n,r))}catch(o){if(o instanceof Je)return T.fail(o.message);throw o}}}function wt(s,t,e){let n=[];for(let r=0;r<s.childCount;r++){let o=s.child(r);o.content.size&&(o=o.copy(wt(o.content,t,o))),o.isInline&&(o=t(o,e,r)),n.push(o)}return w.fromArray(n)}class B extends C{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),r=n.node(n.sharedDepth(this.to)),o=new v(wt(e.content,(a,i)=>!a.isAtom||!i.type.allowsMarkType(this.mark.type)?a:a.mark(this.mark.addToSet(a.marks)),r),e.openStart,e.openEnd);return T.fromReplace(t,this.from,this.to,o)}invert(){return new H(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new B(e.pos,n.pos,this.mark)}merge(t){return t instanceof B&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new B(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new B(e.from,e.to,t.markFromJSON(e.mark))}}C.jsonID("addMark",B);class H extends C{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new v(wt(e.content,r=>r.mark(this.mark.removeFromSet(r.marks)),t),e.openStart,e.openEnd);return T.fromReplace(t,this.from,this.to,n)}invert(){return new B(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new H(e.pos,n.pos,this.mark)}merge(t){return t instanceof H&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new H(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new H(e.from,e.to,t.markFromJSON(e.mark))}}C.jsonID("removeMark",H);class $ extends C{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return T.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return T.fromReplace(t,this.pos,this.pos+1,new v(w.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let n=this.mark.addToSet(e.marks);if(n.length==e.marks.length){for(let r=0;r<e.marks.length;r++)if(!e.marks[r].isInSet(n))return new $(this.pos,e.marks[r]);return new $(this.pos,this.mark)}}return new j(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new $(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new $(e.pos,t.markFromJSON(e.mark))}}C.jsonID("addNodeMark",$);class j extends C{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return T.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return T.fromReplace(t,this.pos,this.pos+1,new v(w.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new $(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new j(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new j(e.pos,t.markFromJSON(e.mark))}}C.jsonID("removeNodeMark",j);class M extends C{constructor(t,e,n,r=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=r}apply(t){return this.structure&&gt(t,this.from,this.to)?T.fail("Structure replace would overwrite content"):T.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new z([this.from,this.to-this.from,this.slice.size])}invert(t){return new M(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new M(e.pos,Math.max(e.pos,n.pos),this.slice)}merge(t){if(!(t instanceof M)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?v.empty:new v(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new M(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?v.empty:new v(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new M(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new M(e.from,e.to,v.fromJSON(t,e.slice),!!e.structure)}}C.jsonID("replace",M);class Z extends C{constructor(t,e,n,r,o,a,i=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=r,this.slice=o,this.insert=a,this.structure=i}apply(t){if(this.structure&&(gt(t,this.from,this.gapFrom)||gt(t,this.gapTo,this.to)))return T.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return T.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?T.fromReplace(t,this.from,this.to,n):T.fail("Content does not fit in gap")}getMap(){return new z([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new Z(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),r=t.map(this.gapFrom,-1),o=t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||r<e.pos||o>n.pos?null:new Z(e.pos,n.pos,r,o,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Z(e.from,e.to,e.gapFrom,e.gapTo,v.fromJSON(t,e.slice),e.insert,!!e.structure)}}C.jsonID("replaceAround",Z);function gt(s,t,e){let n=s.resolve(t),r=e-t,o=n.depth;for(;r>0&&o>0&&n.indexAfter(o)==n.node(o).childCount;)o--,r--;if(r>0){let a=n.node(o).maybeChild(n.indexAfter(o));for(;r>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,r--}}return!1}function Le(s,t){let e=s.resolve(t),n=e.index();return Fe(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(n,n+1)}function Fe(s,t){return!!(s&&t&&!s.isLeaf&&s.canAppend(t))}class Q extends C{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return T.fail("No node at attribute step's position");let n=Object.create(null);for(let o in e.attrs)n[o]=e.attrs[o];n[this.attr]=this.value;let r=e.type.create(n,null,e.marks);return T.fromReplace(t,this.pos,this.pos+1,new v(w.from(r),0,e.isLeaf?0:1))}getMap(){return z.empty}invert(t){return new Q(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Q(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Q(e.pos,e.attr,e.value)}}C.jsonID("attr",Q);class it extends C{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let r in t.attrs)e[r]=t.attrs[r];e[this.attr]=this.value;let n=t.type.create(e,t.content,t.marks);return T.ok(n)}getMap(){return z.empty}invert(t){return new it(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new it(e.attr,e.value)}}C.jsonID("docAttr",it);let X=class extends Error{};X=function s(t){let e=Error.call(this,t);return e.__proto__=s.prototype,e};X.prototype=Object.create(Error.prototype);X.prototype.constructor=X;X.prototype.name="TransformError";function Be(s,t,e){let n=[];for(let a=0;a<s.mapping.maps.length;a++){let i=s.mapping.maps[a];if(i){for(let l=0;l<n.length;l++)n[l]=i.map(n[l]);i.forEach((l,c,u,p)=>n.push(u,p))}}let r=[];for(let a=0;a<n.length;a+=2){let i=n[a],l=n[a+1],c=s.doc.resolve(i),u=c.sharedDepth(l),p=c.node(u);for(let y=c.indexAfter(u),E=c.after(u+1);E<=l;++y){let k=p.maybeChild(y);if(!k)break;if(y&&r.indexOf(E)==-1){let m=p.child(y-1);m.type==k.type&&e.includes(m.type)&&r.push(E)}E+=k.nodeSize}}let o=!1;r.sort((a,i)=>a-i);for(let a=r.length-1;a>=0;a--)Le(s.doc,r[a])&&(t.join(r[a]),o=!0);return o}const He=ot.create({name:"autoJoiner",addOptions(){return{elementsToJoin:[]}},addProseMirrorPlugins(){const s=new lt(this.name),t=[this.editor.schema.nodes.bulletList,this.editor.schema.nodes.orderedList];return this.options.elementsToJoin.forEach(e=>{const n=Xt(e,this.editor.schema);t.push(n)}),[new at({key:s,appendTransaction(e,n,r){let o=r.tr,a=!1;for(const i of e)a=Be(i,o,t)||a;if(a)return o}})]}}),$e=ot.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new at({key:new lt("placeholder"),props:{decorations:({doc:s,selection:t})=>{const e=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=t,r=[];if(!e)return null;const o=this.editor.isEmpty;return s.descendants((a,i)=>{const l=n>=i&&n<=i+a.nodeSize,c=!a.isLeaf&&te(a);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];o&&u.push(this.options.emptyEditorClass);const p=It.node(i,i+a.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:a,pos:i,hasAnchor:l}):this.options.placeholder});r.push(p)}return this.options.includeChildren}),zt.create(s,r)}}})]}}),We=ot.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:s=>s.length,wordCounter:s=>s.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=s=>{const t=(s==null?void 0:s.node)||this.editor.state.doc;if(((s==null?void 0:s.mode)||this.options.mode)==="textSize"){const n=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(n)}return t.nodeSize},this.storage.words=s=>{const t=(s==null?void 0:s.node)||this.editor.state.doc,e=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(e)}},addProseMirrorPlugins(){let s=!1;return[new at({key:new lt("characterCount"),appendTransaction:(t,e,n)=>{if(s)return;const r=this.options.limit;if(r==null||r===0){s=!0;return}const o=this.storage.characters({node:n.doc});if(o>r){const a=o-r,i=0,l=a;console.warn("[CharacterCount] Initial content exceeded limit of ".concat(r," characters. Content was automatically trimmed."));const c=n.tr.deleteRange(i,l);return s=!0,c}s=!0},filterTransaction:(t,e)=>{const n=this.options.limit;if(!t.docChanged||n===0||n===null||n===void 0)return!0;const r=this.storage.characters({node:e.doc}),o=this.storage.characters({node:t.doc});if(o<=n||r>n&&o>n&&o<=r)return!0;if(r>n&&o>n&&o>r||!t.getMeta("paste"))return!1;const i=t.selection.$head.pos,l=o-n,c=i-l,u=i;return t.deleteRange(c,u),!(this.storage.characters({node:t.doc})>n)}})]}});tt.extend(we);tt.extend(ye);tt.extend(Se);tt.locale("zh-tw");const nt=()=>tt.utc().local();class Ue{constructor(){_(this,"timer",null);_(this,"getDomainTime",F(null));this.getDomainTime.value=nt()}calculateNextDelay(){return 1e3-nt().millisecond()}start(){const t=()=>{this.getDomainTime.value=nt();const e=this.calculateNextDelay(),n=nt().valueOf()-this.getDomainTime.value.valueOf();console.log("誤差:",n,"ms"),this.timer=setTimeout(t,e)};t()}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}getTime(){return this.getDomainTime.value}}new Ue;const pt=20,J=12,V="xid: invalid ID",$t=new TextEncoder,_e=new TextDecoder,g=$t.encode("0123456789abcdefghijklmnopqrstuv"),d=new Uint8Array(256).fill(255);for(let s=0;s<g.length;s++)d[g[s]]=s;const Wt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,mt=Ut(),x=class x extends Uint8Array{constructor(t){if(super(J),t==null){const e=new DataView(this.buffer),n=Math.floor(Date.now()/1e3);e.setUint32(0,n),this[4]=x.machineId[0],this[5]=x.machineId[1],this[6]=x.machineId[2],this[7]=x.pid>>8,this[8]=x.pid&255,x.counter+=1,x.counter>16777215&&(x.counter=0),this[9]=x.counter>>16,this[10]=x.counter&255,this[11]=x.counter&255}else{if(!(t instanceof Uint8Array)||t.length!==J)throw new Error(V);this.set(t)}}static default(){return new x(new Uint8Array(J).fill(0))}static fromValue(t){if(t instanceof x)return t;if(typeof t=="string")return x.parse(t);if(t instanceof Uint8Array&&t.length===J)return new x(t);if(t instanceof ArrayBuffer&&t.byteLength===J)return new x(new Uint8Array(t));if(Array.isArray(t)&&t.length===J&&t.every(e=>typeof e=="number"&&e>=0&&e<=255))return new x(new Uint8Array(t));throw new Error(V)}static parse(t){if(t.length!==pt)throw new Error(V);const e=new x;return e.decode(t),e}decode(t){const e=$t.encode(t);if(e.length!==pt)throw new Error(V);for(const n of e)if(d[n]==255)throw new Error(V);if(this[11]=d[e[17]]<<6|d[e[18]]<<1|d[e[19]]>>4,g[this[11]<<4&31]!=e[19])throw new Error(V);this[10]=d[e[16]]<<3|d[e[17]]>>2,this[9]=d[e[14]]<<5|d[e[15]],this[8]=d[e[12]]<<7|d[e[13]]<<2|d[e[14]]>>3,this[7]=d[e[11]]<<4|d[e[12]]>>1,this[6]=d[e[9]]<<6|d[e[10]]<<1|d[e[11]]>>4,this[5]=d[e[8]]<<3|d[e[9]]>>2,this[4]=d[e[6]]<<5|d[e[7]],this[3]=d[e[4]]<<7|d[e[5]]<<2|d[e[6]]>>3,this[2]=d[e[3]]<<4|d[e[4]]>>1,this[1]=d[e[1]]<<6|d[e[2]]<<1|d[e[3]]>>4,this[0]=d[e[0]]<<3|d[e[1]]>>2}encode(){const t=new Uint8Array(pt);return t[19]=g[this[11]<<4&31],t[18]=g[this[11]>>1&31],t[17]=g[this[11]>>6|this[10]<<2&31],t[16]=g[this[10]>>3],t[15]=g[this[9]&31],t[14]=g[this[9]>>5|this[8]<<3&31],t[13]=g[this[8]>>2&31],t[12]=g[this[8]>>7|this[7]<<1&31],t[11]=g[this[7]>>4|this[6]<<4&31],t[10]=g[this[6]>>1&31],t[9]=g[this[6]>>6|this[5]<<2&31],t[8]=g[this[5]>>3],t[7]=g[this[4]&31],t[6]=g[this[4]>>5|this[3]<<3&31],t[5]=g[this[3]>>2&31],t[4]=g[this[3]>>7|this[2]<<1&31],t[3]=g[this[2]>>4|this[1]<<4&31],t[2]=g[this[1]>>1&31],t[1]=g[this[1]>>6|this[0]<<2&31],t[0]=g[this[0]>>3],_e.decode(t)}timestamp(){return new DataView(this.buffer).getUint32(0)}machine(){return new Uint8Array(this.buffer,4,3)}pid(){return this[7]<<8|this[8]}counter(){return this[9]<<16|this[10]<<8|this[11]}isZero(){return super.every(t=>t===0)}toString(){return this.encode()}toBytes(){return new Uint8Array(this.buffer,0,J)}toJSON(){return this.encode()}equals(t){for(let e=0;e<J;e++)if(this[e]!==t[e])return!1;return!0}};_(x,"machineId",Ut()),_(x,"pid",qe()),_(x,"counter",mt[0]<<16|mt[1]<<8|mt[2]);let Ct=x;function Ut(){return Wt.getRandomValues(new Uint8Array(3))}function qe(){if(typeof globalThis=="object"&&"process"in globalThis)return globalThis.process.pid&65535;const s=Wt.getRandomValues(new Uint8Array(2));return s[0]<<8|s[1]}const Ve=xt({__name:"TextEditor",props:{articleHtmlRef:{},articleHtmlRefModifiers:{},isDomainFormat:{type:Boolean},isDomainFormatModifiers:{}},emits:["update:articleHtmlRef","update:isDomainFormat"],setup(s){me();const t=St(s,"articleHtmlRef"),e=St(s,"isDomainFormat");let n=!1,r=F(!0);const o=F(!1),a=F(),i=F(),l=h=>{try{if(!r.value)return;b(h)}catch(f){console.error("自動空白處理時發生錯誤:",f)}},c=new ke({extensions:[...ee,Ae.configure({dragHandleSelector:".drag-handle"}),He,We.configure({limit:L.WORD_LIMIT,textCounter:h=>h.replace(/\s+/g," ").length}),$e.configure({placeholder:({pos:h,node:f,editor:S})=>h===0?"第一段內容會作為標題或封面圖":"新段落..."})],editorProps:{attributes:{spellcheck:"false",inputmode:"text",enterkeyhint:"enter"},handleDOMEvents:{input:(h,f)=>(n||l(c),!1),compositionstart:()=>(n=!0,!1),compositionend:()=>(n=!1,l(c),!1),click:(h,f)=>(setTimeout(()=>{c.commands.focus()},0),!1),touchstart:(h,f)=>(f.stopPropagation(),!1)}},content:t.value,onUpdate:({editor:h})=>{const f=h.getJSON();f&&(t.value=JSON.stringify(f))}}),u=[[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983]],p=h=>{const f=h.codePointAt(0);return f?u.some(([S,N])=>f>=S&&f<=N):!1},y=h=>/^[a-zA-Z0-9]$/.test(h),E=(h,f)=>{if(!h||!f||h===" "||f===" ")return!1;const S=p(h),N=y(h),I=p(f),D=y(f);return S&&D||N&&I},k=(h,f,S)=>{const N=[];let I="",D=0,P=!1;return h&&typeof h.descendants=="function"&&h.descendants((R,U)=>{var ct;R.isText?(R.text||"").split("").forEach((Y,yt)=>{N.push({text:Y,originalPosition:D,nodePosition:U+yt}),I+=Y,D++}):R.type&&R.type.name==="mention"&&(P=!0,(((ct=R.attrs)==null?void 0:ct.label)||"").split("").forEach((Y,yt)=>{N.push({text:Y,originalPosition:D,nodePosition:U}),I+=Y,D++}))}),{mappings:N,text:I,isMention:P,cursorOffset:S-f}},m=h=>{const f=[],{text:S}=h;for(let N=0;N<S.length-1;N++)E(S[N],S[N+1])&&f.push(N+1);return f},O=(h,f,S)=>{const{cursorOffset:N}=h,I=f.filter(P=>P<=N).length;return S.state.selection.from+I},b=h=>{try{if(!h||!h.state||!h.state.selection)return;const f=ne(R=>R.type.name==="paragraph")(h.state.selection);if(!f)return;const{node:S,start:N}=f,I=k(S,N,h.state.selection.from),D=m(I);if(!D.length)return;h.chain().focus().command(({tr:R})=>(D.reverse().forEach(U=>{if(U>=0&&U<I.mappings.length){const ut=I.mappings[U].nodePosition+(I.isMention,0);R.insertText(" ",N+ut)}}),!0)).run();const P=O(I,D,h);P>0&&h.commands.setTextSelection(P)}catch(f){console.error("自動空白處理錯誤:",f)}},W=G(()=>{try{return c.storage.characterCount.characters()}catch(h){return 0}});return G(()=>W.value>=L.WORD_LIMIT),G(()=>W.value>=L.WORD_WARNING&&W.value<L.WORD_LIMIT),G(()=>ht.size>=L.IMAGE_LIMIT),G(()=>ht.size>=L.IMAGE_WARNING&&ht.size<L.IMAGE_LIMIT),ue(a,()=>o.value=!1,{ignore:[i]}),bt(),he(),F(!1),fe(()=>{setTimeout(()=>{c.commands.focus("end")},100)}),(h,f)=>(Dt(),de(st(Ce),{editor:st(c),class:pe({"amDomain-format-editorMode":e.value})},null,8,["editor","class"]))}}),Ge=Ee(Ve,[["__scopeId","data-v-1d80d888"]]),Ye={class:"bg-stone-100 [&>div]:xl:first:mt-[100px] [&>div]:md:first:mt-[80px] [&>div]:max-md:first:mt-[60px]"},Ke={class:"flex w-full"},Ze={class:"xl:w-[600px] md:w-[400px] md:flex max-md:hidden flex-col"},Qe={class:"sticky top-[100px]"},je={class:"text-[1.1rem]"},Xe={class:"w-full xl:max-w-[654px] md:max-w-[550px]"},on=xt({__name:"PostsPage",setup(s){const t=bt(),e="你準備在 ".concat(t.topicTitle," 發表"),n="你正要在 ".concat(t.articleTitle," 留言"),r=G(()=>t.article===""?e:n);return console.log(t.topic),(o,a)=>{const i=Te,l=Oe,c=ve,u=Ge;return Dt(),ge(xe,null,[K(i),q("div",Ye,[K(c,{class:"select-none !pt-5 flex justify-center xl:min-h-[calc(100dvh-100px-(1.25rem*2))] md:min-h-[calc(100dvh-80px-(1rem*2))] max-md:min-h-[calc(100dvh-60px)]"},{default:Et(()=>[q("div",Ke,[q("div",Ze,[q("div",Qe,[K(c,{class:"flex flex-col"},{default:Et(()=>[q("p",je,[K(l,{text:st(r)},null,8,["text"])])]),_:1})])]),q("div",Xe,[K(u)])])]),_:1})])],64)}}});export{on as default};
